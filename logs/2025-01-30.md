# 修改日志 2025-01-30

## README 新增 venv 环境内容

### 修改文件
- `README.md`

### 修改内容

1. **新增「虚拟环境 (venv)」章节**
   - 说明推荐使用本项目 venv 的原因（避免与系统或其他项目环境冲突）。
   - 创建虚拟环境：`python -m venv venv`。
   - Windows 下激活：`venv\Scripts\activate`，退出：`deactivate`。
   - 在虚拟环境中安装依赖：`pip install -r requirements.txt`。
   - 说明运行前需先激活 venv 再执行 `python main.py`。

2. **调整「安装与运行」**
   - 在安装依赖步骤中，将「按虚拟环境创建并激活后执行 pip install」列为推荐方式。
   - 保留原有直接 pip 安装与使用父项目 AutoVideo 虚拟环境的说明。

3. **目录结构**
   - 在目录结构说明中增加 `venv/` 条目，注明为可选、由 `python -m venv venv` 生成。

---

## README 清除父项目相关描述

### 修改文件
- `README.md`

### 修改内容

1. **项目简介**
   - 删除「从 AutoVideo 中分离出的」「可作为独立项目继续完善」等表述。
   - 改为「本工具为渠道视频批量处理独立项目」。

2. **安装与运行**
   - 删除「或使用父项目 AutoVideo 的虚拟环境」的安装方式。
   - FFmpeg 配置中删除「可从父项目 AutoVideo 的 tools/ffmpeg 复制」的说明。

3. **删除「与父项目关系」整节**
   - 移除与 AutoVideo 的复制、保留、解耦等描述。

4. **目录结构**
   - `tools/ffmpeg/` 注释改为「可选」。

---

## README 明确 FFmpeg 默认使用项目内版本

### 修改文件
- `README.md`

### 修改内容

1. **安装与运行**
   - 将「配置 FFmpeg（二选一）」改为「FFmpeg」说明：本项目已包含 FFmpeg（`tools/ffmpeg/`），程序默认使用该目录下的可执行文件；可选说明使用系统 PATH 时程序会回退尝试系统 FFmpeg。

2. **目录结构**
   - `tools/ffmpeg/` 注释由「可选」改为「默认使用」。

---

## 移除系统设置标签，窗口控制区新增主题切换按钮

### 修改文件
- `src/gui/main_window.py`
- `README.md`
- 删除：`src/gui/settings_tab.py`

### 修改内容

1. **主窗口 (main_window.py)**
   - 移除「系统设置」标签及 `create_settings_tab()`。
   - 在标签页上方新增窗口控制区 `control_frame`，右侧放置主题切换按钮。
   - 按钮文案：当前为深色时显示「切换到浅色」，当前为浅色时显示「切换到深色」；点击在深色/浅色间切换并调用 `ThemeSettingsManager.set_theme_setting` 持久化。
   - 主题初始化时若配置为 `system` 则按深色处理，仅支持深色/浅色切换，未使用 emoji 或图标。

---

## 主题切换改为悬浮按钮并固定于左下角

### 修改文件
- `src/gui/main_window.py`

### 修改内容

- 移除顶部窗口控制区 `control_frame`，不再在控制栏内放置主题按钮。
- 主题切换按钮改为悬浮：以 `main_frame` 为父控件，使用 `place(relx=0, rely=1, anchor="sw", x=10, y=-10)` 固定于界面左下角（距左 10px、距底 10px），随窗口缩放仍保持左下角位置。

---

## 主题切换按钮改为开源图标（Lucide），无文本，随深色/浅色状态切换

### 修改文件
- `requirements.txt`：新增 `iconipy>=0.5.0`、`Pillow>=10.0.0`
- 新增 `src/gui/theme_icons.py`：使用 iconipy + Lucide 图标库生成太阳/月亮 CTkImage，深色界面用浅色图标、浅色界面用深色图标以保证可见
- `src/gui/main_window.py`：主题按钮改为仅图标（无文字）、40x40 悬浮按钮；深色模式显示太阳图标（点击切到浅色）、浅色模式显示月亮图标（点击切到深色）；切换后调用 `_update_theme_button_icon()` 更新图标；图标加载失败时回退为「切换到浅色/切换到深色」文案

---

## 主题按钮移至窗口右上角

### 修改文件
- `src/gui/main_window.py`

### 修改内容

- 主题悬浮按钮由左下角改为右上角：`place(relx=0, rely=1, anchor="sw", ...)` 改为 `place(relx=1, rely=0, anchor="ne", x=-10, y=10)`，距右 10px、距上 10px，与界面标注位置一致。

2. **README**
   - 功能列表：删除「系统设置」项，新增「主题切换」：窗口控制区提供深色/浅色主题切换按钮，设置会持久化保存。
   - 项目简介：补充「窗口支持主题切换（深色/浅色）」。

---

## 开发模式：代码变更后自动重启界面

### 新增文件
- `run_dev.py`：开发模式入口，使用 watchdog 监听 `main.py` 与 `src/` 下 `.py` 文件，变更后约 0.8 秒防抖后自动终止并重启 `python main.py` 子进程；Ctrl+C 退出。
- `requirements-dev.txt`：开发依赖，继承 requirements.txt 并增加 `watchdog>=3.0.0`。

### 修改文件
- `README.md`：新增「开发模式」章节（安装 requirements-dev.txt、执行 `python run_dev.py`）；目录结构中补充 `run_dev.py`、`requirements-dev.txt`。

---

## 项目重构：Tauri 2 + Vue 3 + Python

### 目标
将原 CustomTkinter 桌面应用重构为 Tauri 2 桌面壳 + Vue 3 前端 + Python FastAPI 后端架构，保留视频规范、水印、合并及主题功能。

### 新增/修改概览

1. **Python FastAPI 后端 (api/)**
   - 新增 `api/requirements.txt`：fastapi、uvicorn。
   - 新增 `api/main.py`：FastAPI 应用，端口 8765；提供 `/api/theme`（GET/POST）、`/api/normalize`、`/api/watermark`、`/api/merge`；复用 `src/config/settings.py`、`src/utils` 下视频处理逻辑；CORS 已开启。

2. **Vue 3 前端 (frontend/)**
   - 新增 Vue 3 + Vite 工程：`frontend/package.json`、`frontend/vite.config.js`、`frontend/index.html`、`frontend/src/main.js`、`frontend/src/style.css`。
   - 新增 `frontend/src/api.js`：封装对 `http://127.0.0.1:8765` 的 theme、normalize、watermark、merge 请求。
   - 新增 `frontend/src/App.vue`：标签页导航（视频规范、视频水印、视频合并）、主题切换（深色/浅色）。
   - 新增 `frontend/src/views/NormalizerTab.vue`、`WatermarkTab.vue`、`MergeTab.vue`：对应三个功能的表单与 API 调用。

3. **Tauri 2 壳 (src-tauri/)**
   - 新增 `src-tauri/Cargo.toml`：tauri、tauri-plugin-shell 依赖。
   - 新增 `src-tauri/build.rs`、`src-tauri/src/main.rs`、`src-tauri/src/lib.rs`：应用入口；`lib.rs` 在启动时根据 `CARGO_MANIFEST_DIR` 定位项目根目录，使用系统 `python`（或 `PYTHON` 环境变量）启动 `api/main.py` 子进程，再启动 Tauri。
   - 新增 `src-tauri/tauri.conf.json`：产品名、标识符、窗口尺寸；build 中 `frontendDist`、`devUrl`（localhost:5173）、`beforeDevCommand`（npm run dev）、`beforeBuildCommand`（npm run build）；shell 插件允许 python/python3。
   - 新增 `src-tauri/capabilities/default.json`：shell 权限配置。

4. **根目录**
   - 新增根目录 `package.json`：scripts 含 `dev`、`build`、`api`、`tauri`、`dev:tauri`、`build:tauri`；devDependencies 含 `@tauri-apps/cli@^2`。
   - `README.md` 已更新：架构说明（Tauri 2 + Vue 3 + Python）、环境要求（Node.js、Rust、Python、FFmpeg）、快速开始（npm install、venv 与 pip 安装、`npm run tauri dev` / `npm run dev:tauri`）、打包说明、目录结构、可选保留原 Python/CTk 界面方式及 FFmpeg 说明。

### 使用方式
- 开发：项目根目录执行 `npm run tauri dev` 或 `npm run dev:tauri`，Tauri 会先执行 `npm run dev` 启动 Vue，再打开窗口并拉起 Python API。
- 打包：`npm run build` 后执行 `npm run tauri build`（或 `npm run build:tauri`）。
- 原 Python 界面仍可使用：`python main.py` 或 `python run_dev.py`。

---

## Git 初始化并准备上传 GitHub

### 修改/新增文件
- 新增 `.gitignore`
- 本地已完成：`git init`、`git add .`、`git commit`、`git branch -M main`

### 修改内容

1. **`.gitignore`**
   - 排除：`venv/`、`__pycache__/`、`node_modules/`、`frontend/node_modules/`、`src-tauri/target/`、`.env`、常见 IDE/系统临时文件等。
   - `.cursor/`、`.claude/` 未忽略，当前提交包含 AGENTS.md 与 openskills 同步的 skills。

2. **本地 Git 状态**
   - 仓库已初始化，默认分支已重命名为 `main`，首次提交信息为「Initial commit: channel video tools」。
   - GitHub 仓库需在网页端手动创建（MCP 认证失败无法代为创建）；创建后添加 remote 并执行 push 即可完成上传。

---

## 移除 FFmpeg 可执行文件以通过 GitHub 推送

### 原因
- `tools/ffmpeg/` 下 ffmpeg.exe、ffplay.exe、ffprobe.exe 超过 GitHub 单文件 100 MB 限制，导致 push 被拒。

### 修改文件
- `.gitignore`：新增忽略 `tools/ffmpeg/ffmpeg.exe`、`ffplay.exe`、`ffprobe.exe`。
- `tools/ffmpeg/README.md`：新增，说明请将 FFmpeg 可执行文件放置于此目录或使用系统 PATH。
- `README.md`：环境要求与「与 FFmpeg 的关系」改为「请将 FFmpeg 放入 tools/ffmpeg/ 或配置 PATH」；目录结构补充说明。

### 操作
- `git rm --cached` 移除三个 exe 的跟踪，`git commit --amend` 修正初始提交，本地 exe 文件保留。
- 修正后可重新执行 `git push -u origin main` 完成上传。
