# 修改日志 2025-01-30

## README 新增 venv 环境内容

### 修改文件
- `README.md`

### 修改内容

1. **新增「虚拟环境 (venv)」章节**
   - 说明推荐使用本项目 venv 的原因（避免与系统或其他项目环境冲突）。
   - 创建虚拟环境：`python -m venv venv`。
   - Windows 下激活：`venv\Scripts\activate`，退出：`deactivate`。
   - 在虚拟环境中安装依赖：`pip install -r requirements.txt`。
   - 说明运行前需先激活 venv 再执行 `python main.py`。

2. **调整「安装与运行」**
   - 在安装依赖步骤中，将「按虚拟环境创建并激活后执行 pip install」列为推荐方式。
   - 保留原有直接 pip 安装与使用父项目 AutoVideo 虚拟环境的说明。

3. **目录结构**
   - 在目录结构说明中增加 `venv/` 条目，注明为可选、由 `python -m venv venv` 生成。

---

## README 清除父项目相关描述

### 修改文件
- `README.md`

### 修改内容

1. **项目简介**
   - 删除「从 AutoVideo 中分离出的」「可作为独立项目继续完善」等表述。
   - 改为「本工具为渠道视频批量处理独立项目」。

2. **安装与运行**
   - 删除「或使用父项目 AutoVideo 的虚拟环境」的安装方式。
   - FFmpeg 配置中删除「可从父项目 AutoVideo 的 tools/ffmpeg 复制」的说明。

3. **删除「与父项目关系」整节**
   - 移除与 AutoVideo 的复制、保留、解耦等描述。

4. **目录结构**
   - `tools/ffmpeg/` 注释改为「可选」。

---

## README 明确 FFmpeg 默认使用项目内版本

### 修改文件
- `README.md`

### 修改内容

1. **安装与运行**
   - 将「配置 FFmpeg（二选一）」改为「FFmpeg」说明：本项目已包含 FFmpeg（`tools/ffmpeg/`），程序默认使用该目录下的可执行文件；可选说明使用系统 PATH 时程序会回退尝试系统 FFmpeg。

2. **目录结构**
   - `tools/ffmpeg/` 注释由「可选」改为「默认使用」。

---

## 移除系统设置标签，窗口控制区新增主题切换按钮

### 修改文件
- `src/gui/main_window.py`
- `README.md`
- 删除：`src/gui/settings_tab.py`

### 修改内容

1. **主窗口 (main_window.py)**
   - 移除「系统设置」标签及 `create_settings_tab()`。
   - 在标签页上方新增窗口控制区 `control_frame`，右侧放置主题切换按钮。
   - 按钮文案：当前为深色时显示「切换到浅色」，当前为浅色时显示「切换到深色」；点击在深色/浅色间切换并调用 `ThemeSettingsManager.set_theme_setting` 持久化。
   - 主题初始化时若配置为 `system` 则按深色处理，仅支持深色/浅色切换，未使用 emoji 或图标。

---

## 主题切换改为悬浮按钮并固定于左下角

### 修改文件
- `src/gui/main_window.py`

### 修改内容

- 移除顶部窗口控制区 `control_frame`，不再在控制栏内放置主题按钮。
- 主题切换按钮改为悬浮：以 `main_frame` 为父控件，使用 `place(relx=0, rely=1, anchor="sw", x=10, y=-10)` 固定于界面左下角（距左 10px、距底 10px），随窗口缩放仍保持左下角位置。

---

## 主题切换按钮改为开源图标（Lucide），无文本，随深色/浅色状态切换

### 修改文件
- `requirements.txt`：新增 `iconipy>=0.5.0`、`Pillow>=10.0.0`
- 新增 `src/gui/theme_icons.py`：使用 iconipy + Lucide 图标库生成太阳/月亮 CTkImage，深色界面用浅色图标、浅色界面用深色图标以保证可见
- `src/gui/main_window.py`：主题按钮改为仅图标（无文字）、40x40 悬浮按钮；深色模式显示太阳图标（点击切到浅色）、浅色模式显示月亮图标（点击切到深色）；切换后调用 `_update_theme_button_icon()` 更新图标；图标加载失败时回退为「切换到浅色/切换到深色」文案

---

## 主题按钮移至窗口右上角

### 修改文件
- `src/gui/main_window.py`

### 修改内容

- 主题悬浮按钮由左下角改为右上角：`place(relx=0, rely=1, anchor="sw", ...)` 改为 `place(relx=1, rely=0, anchor="ne", x=-10, y=10)`，距右 10px、距上 10px，与界面标注位置一致。

2. **README**
   - 功能列表：删除「系统设置」项，新增「主题切换」：窗口控制区提供深色/浅色主题切换按钮，设置会持久化保存。
   - 项目简介：补充「窗口支持主题切换（深色/浅色）」。

---

## 开发模式：代码变更后自动重启界面

### 新增文件
- `run_dev.py`：开发模式入口，使用 watchdog 监听 `main.py` 与 `src/` 下 `.py` 文件，变更后约 0.8 秒防抖后自动终止并重启 `python main.py` 子进程；Ctrl+C 退出。
- `requirements-dev.txt`：开发依赖，继承 requirements.txt 并增加 `watchdog>=3.0.0`。

### 修改文件
- `README.md`：新增「开发模式」章节（安装 requirements-dev.txt、执行 `python run_dev.py`）；目录结构中补充 `run_dev.py`、`requirements-dev.txt`。

---

## 项目重构：Tauri 2 + Vue 3 + Python

### 目标
将原 CustomTkinter 桌面应用重构为 Tauri 2 桌面壳 + Vue 3 前端 + Python FastAPI 后端架构，保留视频规范、水印、合并及主题功能。

### 新增/修改概览

1. **Python FastAPI 后端 (api/)**
   - 新增 `api/requirements.txt`：fastapi、uvicorn。
   - 新增 `api/main.py`：FastAPI 应用，端口 8765；提供 `/api/theme`（GET/POST）、`/api/normalize`、`/api/watermark`、`/api/merge`；复用 `src/config/settings.py`、`src/utils` 下视频处理逻辑；CORS 已开启。

2. **Vue 3 前端 (frontend/)**
   - 新增 Vue 3 + Vite 工程：`frontend/package.json`、`frontend/vite.config.js`、`frontend/index.html`、`frontend/src/main.js`、`frontend/src/style.css`。
   - 新增 `frontend/src/api.js`：封装对 `http://127.0.0.1:8765` 的 theme、normalize、watermark、merge 请求。
   - 新增 `frontend/src/App.vue`：标签页导航（视频规范、视频水印、视频合并）、主题切换（深色/浅色）。
   - 新增 `frontend/src/views/NormalizerTab.vue`、`WatermarkTab.vue`、`MergeTab.vue`：对应三个功能的表单与 API 调用。

3. **Tauri 2 壳 (src-tauri/)**
   - 新增 `src-tauri/Cargo.toml`：tauri、tauri-plugin-shell 依赖。
   - 新增 `src-tauri/build.rs`、`src-tauri/src/main.rs`、`src-tauri/src/lib.rs`：应用入口；`lib.rs` 在启动时根据 `CARGO_MANIFEST_DIR` 定位项目根目录，使用系统 `python`（或 `PYTHON` 环境变量）启动 `api/main.py` 子进程，再启动 Tauri。
   - 新增 `src-tauri/tauri.conf.json`：产品名、标识符、窗口尺寸；build 中 `frontendDist`、`devUrl`（localhost:5173）、`beforeDevCommand`（npm run dev）、`beforeBuildCommand`（npm run build）；shell 插件允许 python/python3。
   - 新增 `src-tauri/capabilities/default.json`：shell 权限配置。

4. **根目录**
   - 新增根目录 `package.json`：scripts 含 `dev`、`build`、`api`、`tauri`、`dev:tauri`、`build:tauri`；devDependencies 含 `@tauri-apps/cli@^2`。
   - `README.md` 已更新：架构说明（Tauri 2 + Vue 3 + Python）、环境要求（Node.js、Rust、Python、FFmpeg）、快速开始（npm install、venv 与 pip 安装、`npm run tauri dev` / `npm run dev:tauri`）、打包说明、目录结构、可选保留原 Python/CTk 界面方式及 FFmpeg 说明。

### 使用方式
- 开发：项目根目录执行 `npm run tauri dev` 或 `npm run dev:tauri`，Tauri 会先执行 `npm run dev` 启动 Vue，再打开窗口并拉起 Python API。
- 打包：`npm run build` 后执行 `npm run tauri build`（或 `npm run build:tauri`）。
- 原 Python 界面仍可使用：`python main.py` 或 `python run_dev.py`。

---

## Git 初始化并准备上传 GitHub

### 修改/新增文件
- 新增 `.gitignore`
- 本地已完成：`git init`、`git add .`、`git commit`、`git branch -M main`

### 修改内容

1. **`.gitignore`**
   - 排除：`venv/`、`__pycache__/`、`node_modules/`、`frontend/node_modules/`、`src-tauri/target/`、`.env`、常见 IDE/系统临时文件等。
   - `.cursor/`、`.claude/` 未忽略，当前提交包含 AGENTS.md 与 openskills 同步的 skills。

2. **本地 Git 状态**
   - 仓库已初始化，默认分支已重命名为 `main`，首次提交信息为「Initial commit: channel video tools」。
   - GitHub 仓库需在网页端手动创建（MCP 认证失败无法代为创建）；创建后添加 remote 并执行 push 即可完成上传。

---

## 移除 FFmpeg 可执行文件以通过 GitHub 推送

### 原因
- `tools/ffmpeg/` 下 ffmpeg.exe、ffplay.exe、ffprobe.exe 超过 GitHub 单文件 100 MB 限制，导致 push 被拒。

### 修改文件
- `.gitignore`：新增忽略 `tools/ffmpeg/ffmpeg.exe`、`ffplay.exe`、`ffprobe.exe`。
- `tools/ffmpeg/README.md`：新增，说明请将 FFmpeg 可执行文件放置于此目录或使用系统 PATH。
- `README.md`：环境要求与「与 FFmpeg 的关系」改为「请将 FFmpeg 放入 tools/ffmpeg/ 或配置 PATH」；目录结构补充说明。

### 操作
- `git rm --cached` 移除三个 exe 的跟踪，`git commit --amend` 修正初始提交，本地 exe 文件保留。
- 修正后可重新执行 `git push -u origin main` 完成上传。

---

## 前端 UI/UX 完善：简洁现代风格与深色/浅色模式

### 依据
- 调用 frontend-design 技能，统一设计令牌、排版与动效，支持深色/浅色双主题。

### 修改文件
- `frontend/index.html`
- `frontend/src/style.css`
- `frontend/src/App.vue`
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/views/MergeTab.vue`

### 修改内容

1. **设计令牌与全局样式 (style.css + index.html)**
   - `index.html`：引入 Google Fonts「DM Sans」作为正文字体，preconnect 优化加载。
   - `style.css`：新增 CSS 变量（浅色/深色双主题）：`--bg`、`--bg-elevated`、`--fg`、`--fg-muted`、`--card`、`--card-hover`、`--border`、`--border-focus`、`--primary`、`--primary-hover`、`--primary-ghost`、`--radius-*`、`--shadow-*`、`--transition-*`；浅色主题为暖灰背景与青绿主色，深色主题为纯黑背景与亮青绿主色。
   - 全局：`body` 使用 `var(--font-sans)`、抗锯齿；按钮与表单控件统一过渡与焦点环（`border-focus` + `primary-ghost` 阴影）；`button.primary` / `button.secondary`、`input` / `select` / `textarea` 统一样式。

2. **共享布局类 (style.css)**
   - `.panel`：内容区最大宽度 720px、居中。
   - `.section-card`：卡片式区块（背景、边框、圆角、内边距、阴影），hover 时边框变亮。
   - `.section-title`、`.hint`、`.form-row`、`.full-width`、`.log-box`、`.actions`：统一标题、提示、表单行、全宽输入、日志区域与操作区样式。

3. **App.vue**
   - 布局：`.app` 使用 flex 列布局；`.header` 增加内边距与阴影；主题按钮增加图标区（L/D）与 `aria-label`；导航使用 `role="tablist"` / `role="tab"` / `aria-selected`。
   - Tab 切换：由 `v-show` 改为 `v-if` + `Transition`（`tab-fade`），切换时淡入淡出。
   - 样式：Tab 激活态与底部边框衔接为「卡片式」选中效果；内容区 `padding: 24px 20px`。

4. **三个 Tab 页面 (NormalizerTab / WatermarkTab / MergeTab)**
   - 区块统一使用 `section-card` 替代 `section`，操作区使用 `actions` 容器，日志区使用 `log-box`；表单行使用 `form-row`。
   - 处理中状态：主按钮文案改为「处理中...」/「合并中...」，提升反馈。
   - 各 Tab 仅保留必要的 scoped 样式（如 `file-input`、`input-num`、`input-opacity`、`select-position`）。

### 效果
- 简洁现代风格：DM Sans 字体、青绿主色、卡片式区块、统一圆角与阴影。
- 深色/浅色模式：通过 `[data-theme="dark"]` 切换整套变量，主题切换即时生效。
- 可访问性：焦点环、按钮 aria、Tab 语义化；无 emoji，符合项目规范。

---

## 前端界面调整为桌面工具风格并加入开源图标

### 目标
将界面从「网页感」调整为「桌面工具」风格，适当收紧布局，并引入开源图标库 Lucide 统一视觉。

### 修改文件
- `frontend/package.json`：新增依赖 `lucide-vue-next`
- `frontend/src/style.css`：区块与标题样式微调（更紧凑），新增 `.section-title .icon-wrap`、`.actions .btn-icon`
- `frontend/src/App.vue`：标题旁加 Wrench 图标，主题按钮用 Sun/Moon 图标，Tab 用 ScanLine / ImagePlus / Merge 图标；整体 padding 略减
- `frontend/src/views/NormalizerTab.vue`：区块标题加 FolderInput / FolderOpen / SlidersHorizontal / ScrollText，按钮加 Play / RotateCcw
- `frontend/src/views/WatermarkTab.vue`：区块标题加 Video / Image / FolderOpen / SlidersHorizontal / ScrollText，按钮加 Play / RotateCcw
- `frontend/src/views/MergeTab.vue`：区块标题加 Video / PlusCircle / FileOutput / ListOrdered / ScrollText，按钮加 Play / RotateCcw

### 修改内容
1. **图标库**：使用 Lucide Icons（ISC 开源），通过 `lucide-vue-next` 按需引入 Vue 组件。
2. **工具化布局**：header / tabs / content 内边距缩小；section-card 圆角改为 `radius-md`、padding 与 margin 略减；内容区可滚动。
3. **图标使用**：标题栏「渠道视频批量处理工具」左侧 Wrench；主题切换为 Sun（深色时点切浅色）/ Moon（浅色时点切深色）；三个 Tab 分别为 ScanLine（视频规范）、ImagePlus（视频水印）、Merge（视频合并）；各页区块标题与「开始/重置」「处理日志」旁配对应语义图标。
4. **无 emoji**：仅使用 Lucide 矢量图标，符合项目规范。

---

## 所有文件/目录选择改为使用原生文件管理器

### 目标
将前端的文件、目录、另存为路径全部改为通过 Tauri 原生对话框（系统文件管理器）选择，不再依赖网页 file input 或纯手输路径。

### 修改文件
- `src-tauri/Cargo.toml`：新增依赖 `tauri-plugin-dialog = "2"`
- `src-tauri/src/lib.rs`：注册 `tauri_plugin_dialog::init()`
- `src-tauri/capabilities/default.json`：新增权限 `dialog:allow-open`、`dialog:allow-save`
- `frontend/package.json`：新增依赖 `@tauri-apps/plugin-dialog`
- `frontend/src/dialog.js`：新建，封装 `openFiles`、`openFile`、`openDir`、`saveFile`，带视频/图片过滤器，非 Tauri 环境静默返回 null
- `frontend/src/views/NormalizerTab.vue`：移除 `<input type="file">`；输入文件增加「选择文件」按钮（多选视频）；输出目录增加「选择目录」按钮
- `frontend/src/views/WatermarkTab.vue`：输入视频增加「选择视频」；水印图片、输出目录增加「选择图片」「选择目录」
- `frontend/src/views/MergeTab.vue`：主体视频、插入视频增加「选择」；输出路径增加「另存为」（save 对话框）

### 修改内容
1. **Tauri 侧**：集成 dialog 插件并开放 open/save 权限。
2. **前端 dialog.js**：统一封装打开文件（单/多）、选择目录、另存为；视频过滤器含 mp4/mkv/avi/mov 等，图片含 png/jpg 等；调用失败（如浏览器环境）返回 null。
3. **三个 Tab**：每个路径输入旁增加对应按钮，点击后调 dialog 接口，将选中路径回填到输入框；Normalizer 仅保留「选择文件」+「选择目录」，不再使用网页 file input。

---

## 选择视频支持文件夹与队列累计；开始/重置去图标并顶对齐日志框

### 目标
1. 选择视频支持选择文件夹，多次选择（文件或文件夹）全部计入处理队列，可点「重置」恢复初始。
2. 「开始处理」「重置」按钮去掉图标；「开始处理」上边缘与日志显示框上沿对齐。

### 修改文件
- `src-tauri/src/lib.rs`
- `frontend/src/dialog.js`
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/views/MergeTab.vue`
- `frontend/src/style.css`

### 修改内容

1. **后端 (lib.rs)**
   - 新增 Tauri 命令 `list_video_files_in_dir(dir: String)`：读取目录，仅当前层级，筛选扩展名为 mp4/mkv/avi/mov/wmv/flv/webm 的文件，返回路径列表；非目录或读失败返回错误。

2. **前端 dialog.js**
   - 引入 `@tauri-apps/api/core` 的 `invoke`。
   - 新增 `listVideoFilesInDir(dir)`：调用 `list_video_files_in_dir`，失败或非 Tauri 环境返回 null。

3. **视频填充 / 水印 Tab（NormalizerTab、WatermarkTab）**
   - 新增「选择文件夹」按钮：调用 `openDir()` 后 `listVideoFilesInDir(dir)`，将得到的路径追加到当前队列并去重；日志提示「已添加文件夹内 N 个视频，当前共 M 个」或「该文件夹内没有视频文件」。
   - 「选择视频」改为追加逻辑：每次选中的文件追加到现有队列并去重（`appendPaths`），日志提示「已添加 N 个文件，当前共 M 个」。
   - 重置按钮继续清空路径与其它初始状态，恢复初始设置。

4. **三个 Tab 按钮与布局**
   - NormalizerTab、WatermarkTab、MergeTab：移除「开始处理」「重置」按钮上的 Play、RotateCcw 图标，仅保留文字。
   - `style.css`：`.log-with-buttons .btn-col` 增加 `padding-top: 2.25rem`，使「开始处理」按钮上边缘与日志框上沿对齐（与日志区标题+间距等高）。

---

## 选择视频与选择文件夹合并为一个按钮

### 目标
将「选择视频」和「选择文件夹」合并为单一按钮，点击后通过下拉菜单选择「添加文件」或「添加文件夹」。

### 修改文件
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/style.css`

### 修改内容
1. **视频填充 / 水印 Tab**：原「选择视频」「选择文件夹」两个按钮改为一个「选择视频」按钮；点击后展开下拉菜单，包含「添加文件」「添加文件夹」两项，分别执行原有多选文件、选择目录并列出视频的逻辑；展开时按钮文案为「收起」，点击区域外或选择项后关闭下拉。
2. **样式**：新增 `.select-video-wrap`（相对定位）、`.select-video-dropdown`（绝对定位、卡片样式）、`.dropdown-item`（菜单项悬停样式），下拉与主题变量一致。

---

## 选择视频改为弹窗对话框

### 目标
将「选择视频」的下拉菜单改为弹窗对话框，点击「选择视频」后弹出居中对话框，提供「添加文件」「添加文件夹」「取消」选项，提升可用性。

### 修改文件
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/style.css`

### 修改内容
1. **视频填充 / 水印 Tab**：移除下拉菜单（select-video-wrap、dropdown、点击外部关闭逻辑）；点击「选择视频」改为打开弹窗（`videoDialogOpen`）；弹窗使用 `<Teleport to="body">` 挂载，遮罩覆盖整窗；弹窗内标题「选择视频」、说明「将视频加入处理队列，可多次添加。」、三个按钮「添加文件」「添加文件夹」「取消」；点击「添加文件」/「添加文件夹」执行原逻辑并关闭弹窗，点击「取消」或点击遮罩关闭弹窗。
2. **样式**：删除 `.select-video-wrap`、`.select-video-dropdown`、`.dropdown-item`；新增 `.dialog-overlay`（fixed 全屏、半透明背景）、`.dialog-box`（居中卡片）、`.dialog-title`、`.dialog-desc`、`.dialog-actions`（按钮组），与主题变量一致。

---

## 参考工具界面实现界面优化

### 目标
参考提供的工具界面截图，实现顶部标题栏、侧栏风格、拖拽区、分段按钮及整体视觉统一。

### 修改文件
- `src-tauri/tauri.conf.json`
- `src-tauri/capabilities/default.json`
- `frontend/src/App.vue`
- `frontend/src/style.css`
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/views/MergeTab.vue`

### 修改内容

1. **顶部标题栏**
   - `tauri.conf.json`：窗口增加 `decorations: false`，使用自定义标题栏。
   - `capabilities/default.json`：新增 `core:window:allow-close`、`allow-minimize`、`allow-maximize`、`allow-toggle-maximize`、`allow-start-dragging`。
   - `App.vue`：新增 `<header class="titlebar" data-tauri-drag-region>`，左侧「视频批量处理」标题，右侧三个按钮（最小化、最大化、关闭），点击分别调用 `getCurrentWindow().minimize()`、`toggleMaximize()`、`close()`；标题栏与内容区用 `content-wrap` 包裹侧栏与主内容。

2. **侧栏风格**
   - 导航项改为矩形高亮：去掉左侧竖条，使用 `margin: 0 8px`、`border-radius: var(--radius-sm)`，选中态 `background: var(--primary-ghost)`、文字与图标 `color: var(--primary)`；图标通过 `color: inherit` 继承主色。

3. **拖拽区与拖放逻辑**
   - `App.vue`：在 `onMounted` 中监听 Tauri 的 `onDragDropEvent`，当 `payload.type === 'drop'` 时过滤视频扩展名（mp4/mkv/avi/mov/wmv/flv/webm），通过 `window.dispatchEvent(new CustomEvent('app-file-drop', { detail: { paths } }))` 派发；`onUnmounted` 时取消监听。
   - `NormalizerTab.vue`：输入文件区改为大虚线框「拖拽视频文件到这里」+「选择视频文件」主按钮 + 下方已选数量；`drop-zone` 上 `@dragover`/`@dragleave`/`@drop` 控制 `dropActive` 高亮，`@drop` 仅 `preventDefault` 并重置状态；监听 `app-file-drop` 事件并 `appendPaths`，日志提示「已拖入 N 个文件」。
   - `WatermarkTab.vue`：待处理视频区同样改为拖拽区 + 选择视频按钮 + 已选数量，并监听 `app-file-drop` 追加路径。
   - `style.css`：新增 `.drop-zone`（虚线边框、居中文案与按钮）、`.drop-zone-active` 与 hover 时主色边框与背景。

4. **合并页插入位置改为分段按钮**
   - `MergeTab.vue`：将「插入位置」的 radio 改为 `.segmented` 内两个 button「片头」「片尾」，选中项带 `active` 类；移除原 `.radio-row`、`.radio-label` 样式。
   - `style.css`：新增 `.segmented`（横向按钮组、边框与圆角）、`.segmented button` 与 `.segmented button.active`（选中态背景与阴影）。

5. **整体**
   - 标题栏样式：高度 36px，按钮 40×36px，关闭按钮 hover 红色；内容区与侧栏布局不变，仅视觉与交互与参考图对齐。

---

## 输入视频区域统一在右侧并增加视频列表与状态

### 目标
将选择输入视频区域统一放在右侧；导入的视频以列表展示；处理开始/结束时每项显示状态变化（待处理、处理中、成功、失败）。

### 修改文件
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`

### 修改内容

1. **NormalizerTab（视频填充）**
   - 布局改为左右两栏：左侧为「输出设置」+「处理参数」（输出目录、目标宽高、填充颜色）；右侧为「输入视频」：拖拽区 + 视频列表 + 下方处理日志与进度、开始/重置按钮。
   - 数据由 `inputPathsText` 改为 `videoList`：数组项为 `{ path, status }`，`status` 为 `pending` | `processing` | `success` | `fail`。
   - 拖拽或弹窗添加的视频去重后追加到 `videoList`，初始状态为 `pending`。
   - 开始处理时将所有项设为 `processing`；流式 `done` 事件中根据 `ev.results[path]` 将对应项设为 `success` 或 `fail`；请求异常时未完成的项设为 `fail`。
   - 右侧展示可滚动视频列表：每行显示文件名（`path` 取 basename）+ 状态标签（待处理/处理中/成功/失败），空列表时显示「暂无视频，请拖入或选择」。

2. **WatermarkTab（视频水印）**
   - 布局改为左右两栏：左侧为「水印图片」「不透明度」「水印位置」「输出目录」；右侧为「待处理视频」：拖拽区 + 视频列表 + 处理日志与进度，底部为开始/重置按钮。
   - 同样使用 `videoList`（`{ path, status }`），拖拽/添加去重、开始处理时全量设为 `processing`，`done` 时按 `ev.results` 更新每项为 `success` 或 `fail`。
   - 视频列表样式与 NormalizerTab 一致：列表区域可滚动、每项文件名 + 状态标签，空列表提示「暂无视频，请拖入或选择」。

3. **状态样式**
   - 待处理：灰底、灰色文字；处理中：主色浅底、主色文字；成功：绿色浅底、绿色文字；失败：红色浅底、红色文字。

---

## 参考图片统一界面与交互：标题栏图标、底部操作栏

### 目标
对照参考图：标题栏左侧增加播放/视频图标；增加底部操作栏（左侧设置/添加/菜单图标、右侧「开始处理」）；「开始处理」由底部栏统一触发，各 Tab 仅保留「重置」。

### 修改文件
- `frontend/src/App.vue`
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/views/MergeTab.vue`

### 修改内容

1. **标题栏**
   - 左侧由纯文字改为「图标 + 视频批量处理」：使用 Lucide `Play` 图标，主色填充，与参考图紫色播放图标对应。

2. **底部操作栏（footer-bar）**
   - 全宽底栏，高度 48px，背景 `--bg-elevated`，上边框分隔。
   - 左侧：三个图标按钮（Settings 设置、Plus 添加、Menu 菜单），透明底、悬停高亮，当前为占位，可后续绑定功能。
   - 右侧：主按钮「开始处理」，处理中时文案为「处理中...」并禁用；点击时调用当前 Tab 注册的 `start` 方法。

3. **Tab 与底部栏联动**
   - App 使用 `reactive` 维护 `tabState = { start, processing }`，并通过 `provide('tabState', tabState)` 下发。
   - NormalizerTab / WatermarkTab / MergeTab 在 `onMounted` 中：将本 Tab 的 `start` 赋给 `tabState.start`，并用 `watch` 将本 Tab 的 `processing` 同步到 `tabState.processing`。
   - 各 Tab 在 `onUnmounted` 中清除 `tabState.start` 与 `tabState.processing`，避免切换 Tab 后误触发。
   - 内容区内的「开始处理」按钮移除，仅保留「重置」；底部栏的「开始处理」统一触发当前 Tab 的 start。

---

## 三栏布局：左侧功能导航、中间功能设置、右侧视频列表

### 目标
将主内容区明确为三栏：左侧为功能导航（侧栏）、中间为功能设置、右侧为视频列表。

### 修改文件
- `frontend/src/App.vue`
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/views/MergeTab.vue`

### 修改内容

1. **App.vue**
   - 主内容区 `main` 增加 `content-body` 与 `aria-label="功能设置与视频列表"`，便于语义与无障碍。

2. **NormalizerTab / WatermarkTab**
   - 使用统一结构：`.main-layout` > `.main-row`（中间 | 右侧）> `.log-section`。
   - **中间（功能设置）**：`.pane-settings`，顶部标题「功能设置」，内为 `.section-card`（输出设置、处理参数 / 水印图片、不透明度、位置、输出目录等）。
   - **右侧（视频列表）**：`.pane-video-list`，顶部标题「视频列表」，内为拖拽区 + 「选择视频文件」按钮 + 可滚动视频列表（文件名 + 状态）；WatermarkTab 右侧还含处理日志与进度条。
   - 样式：`.main-row` 为 flex 行，`.pane-settings` 固定宽度约 280px，`.pane-video-list` 占满剩余宽度；`.log-section` 在下方整行展示。

3. **MergeTab**
   - 同样采用 `.main-layout` + `.main-row`：中间 `.pane-settings` 为「功能设置」（主体视频、插入视频、插入位置、输出路径）；右侧 `.pane-video-list` 标题「视频列表」，内容为说明「合并功能为单文件操作，此处无批量视频列表。」，保持三栏结构一致。
   - 下方 `.log-section` 为处理日志与重置按钮。

---

## 移除处理日志区域

### 目标
去掉界面中的「处理日志」展示区域（标题、日志文本框、进度条），保留「重置」按钮。

### 修改文件
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/views/MergeTab.vue`

### 修改内容

1. **NormalizerTab**：删除整块「处理日志」区块（含「处理日志」标题、`pre.log-box`、进度条）；原区块改为仅保留「重置」按钮的 `.actions-row`。移除 `ScrollText` 图标引用，样式 `.log-section` 改为 `.actions-row`。

2. **WatermarkTab**：在右侧 `.pane-video-list` 中删除「处理日志」标题、`pre.log-box`、进度条；保留拖拽区与视频列表。移除 `ScrollText` 引用及 `.log-in-col` 样式。底部「重置」仍在 `watermark-footer` 中。

3. **MergeTab**：删除整块「处理日志」区块（标题、日志框、进度条），改为仅含「重置」的 `.actions-row`。移除 `ScrollText` 引用，样式 `.log-section` 改为 `.actions-row`。

4. **脚本**：各 Tab 内用于写日志的 `logLines`、`log()`、`logText` 等逻辑保留，仅不再在界面展示；处理完成弹窗仍由流式 `done` 事件设置 `doneModalMsg`，不受影响。

---

## 统一视频导入实现

### 目标
将「选择/导入视频文件」相关逻辑统一为同一套实现，避免各 Tab 各自实现导致的不一致与重复。

### 修改文件
- 新增：`frontend/src/composables/useVideoImport.js`
- 新增：`frontend/src/composables/useSingleVideoDialog.js`
- 新增：`frontend/src/components/VideoImportDialog.vue`
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/views/MergeTab.vue`

### 修改内容

1. **useVideoImport.js（批量导入）**
   - 封装视频列表状态、弹窗开关、拖拽区状态、`appendPaths`、文件/文件夹选择（`openFiles`、`openDir`、`listVideoFilesInDir`）、`handleAddFiles`/`handleAddFolder`、`filename`/`statusText`、`registerAppDrop`、`clearVideoList`。
   - 支持可选 `onLog` 回调，用于「已添加 N 个文件」等日志。

2. **useSingleVideoDialog.js（单文件选择弹窗）**
   - 与批量导入使用同一弹窗 UI：通过 context（如 `main`/`insert`）区分当前选择目标，选择完成后通过回调 `onSelected(context, path)` 回传第一个路径。
   - 内部同样使用 `dialog.js` 的 `openFiles`、`openDir`、`listVideoFilesInDir`，保证与批量逻辑一致。

3. **VideoImportDialog.vue（共享弹窗组件）**
   - 统一弹窗结构：标题「选择视频」，按钮「添加文件」「添加文件夹」，右上角关闭。
   - props：`show`；事件：`close`、`add-files`、`add-folder`。具体选文件/文件夹由父组件或 composable 处理。

4. **NormalizerTab / WatermarkTab**
   - 使用 `useVideoImport({ onLog: log })` 替代原有本地 `videoList`、弹窗、拖拽、`appendPaths`、`pickInputFiles`/`pickInputFolder` 等重复实现。
   - 使用 `VideoImportDialog` 替代内联弹窗模板；重置时调用 `clearVideoList()`。
   - 移除未使用的 `X` 图标与 `openFiles`/`listVideoFilesInDir` 直接引用（由 composable 内部使用）。

5. **MergeTab**
   - 使用 `useSingleVideoDialog(onVideoSelected)` 与 `VideoImportDialog`，与其它 Tab 共用同一弹窗 UI 与同一套 `dialog.js` 选择逻辑。
   - 主体视频、插入视频均改为点击「选择视频」打开同一弹窗，通过 context `main`/`insert` 区分；选择后取第一个路径写入对应 ref。
   - 路径展示使用统一的 `displayPath`（仅显示文件名）；原「选择文件」按钮文案统一为「选择视频」。
   - 移除直接调用 `openFile()` 的 `pickMainVideo`/`pickInsertVideo`。

---

## 合并 Tab 右侧视频列表展示已选视频

### 修改文件
- `frontend/src/views/MergeTab.vue`

### 修改内容
- 右侧「视频列表」由占位文案改为固定两行列表：**主体视频**、**插入视频**，每行显示对应文件名（`displayPath`），未选择时显示「请选择主体视频」/「请选择要插入的视频文件」。
- 使用与其它 Tab 一致的 `.video-list-wrap`、`.video-list`、`.video-list-item` 样式；新增 `.video-list-label`（固定宽度标签）、`.video-list-filename`（单行省略），路径完整信息通过 `title` 悬停展示。

---

## 右侧视频列表统一语义：始终显示将要被处理或已处理的视频

### 目标
无论哪个 Tab，右侧「视频列表」始终表示：将要被处理或已处理的视频列表，展示与状态一致。

### 修改文件
- `frontend/src/views/MergeTab.vue`

### 修改内容
1. **列表结构统一**：合并 Tab 右侧列表改为与视频填充、视频水印一致：仅「文件名 + 状态」两列，去掉「主体视频/插入视频」标签列；两行固定为：第 1 行主体视频、第 2 行插入视频，未选时显示占位文案。
2. **状态与样式**：新增 `mergeStatus`（pending/processing/success/fail），与 `mergeVideoList` 联动；未选路径时状态为「待选择」。使用与其它 Tab 相同的 `.video-list-status` 及 status-pending/processing/success/fail/empty 样式。
3. **流程**：开始合并时设为「处理中」，成功/失败后设为「成功」/「失败」；重置时恢复「待处理」。
4. 视频填充、视频水印 Tab 的右侧列表本就表示「待处理/处理中/成功/失败」的列表，无需改动。

---

## 合并 Tab：片头/片尾选择置于中间设置区

### 修改文件
- `frontend/src/views/MergeTab.vue`

### 修改内容
- 「插入位置（片头/片尾）」从第三项调整为第二项，置于中间「功能设置」区内、紧接「主体视频」之后、在「插入视频」与「输出路径」之前。
- 中间区顺序为：主体视频 → 插入位置（片头/片尾）→ 插入视频 → 输出路径；右侧仅保留「视频列表」，不包含片头/片尾选择。

---

## 中间功能设置区域加宽

### 修改文件
- `frontend/src/App.vue`

### 修改内容
- `content-wrap` 的 `grid-template-columns` 中间列由 `280px` 改为 `360px`。
- `.tab-settings-wrap` 的 `flex` 由 `0 0 280px` 改为 `0 0 360px`，`min-width` 由 `220px` 改为 `280px`，使功能设置区更宽、表单与控件更易排布。

---

## 右侧区域底部空白修复（底部状态栏占满整行）

### 修改文件
- `frontend/src/App.vue`

### 修改内容
- 原因：底部状态栏原为 `grid-column: 1 / 3`，只占左两列，右侧在第二行为空网格格，出现底部空白。
- 将 `.footer-bar` 改为 `grid-column: 1 / -1`，使状态栏横跨三列，右侧底部由状态栏填充，不再留白。

---

## 功能设置区文字缩小

### 修改文件
- `frontend/src/App.vue`
- `frontend/src/views/WatermarkTab.vue`

### 修改内容
- **App.vue**：在 `.tab-settings-wrap` 下统一缩小功能设置区文字：区域基准 `font-size: 13px`；小节标题 `.section-title` 为 `0.8125rem`；表单标签 `.form-row label`、按钮、输入框/下拉为 `13px`；说明文字 `.hint` 为 `12px`；`.segmented` 内按钮 `13px`。
- **WatermarkTab.vue**：`.opacity-unit` 由 `14px` 改为 `12px`，`.position-btn` 由 `13px` 改为 `12px`。

---

## 去掉功能设置区小节标题前的图标

### 修改文件
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/views/MergeTab.vue`

### 修改内容
- 各 Tab 中所有 `<h3 class="section-title">` 内的 `<span class="icon-wrap">...</span>` 及其中 lucide 图标组件已移除，仅保留文字标题。
- 同步移除各文件中仅用于上述图标的 `lucide-vue-next` 导入（NormalizerTab：FolderOpen、SlidersHorizontal；WatermarkTab：Image、FolderOpen、SlidersHorizontal、LayoutGrid；MergeTab：PlusCircle、ListOrdered、FolderOpen）。

---

## 去掉底部状态栏的菜单按钮

### 修改文件
- `frontend/src/App.vue`

### 修改内容
- 移除底部状态栏（footer-bar）中「菜单」图标按钮及其 `lucide-vue-next` 的 `Menu` 导入。

---

## 全局文本按钮缩小

### 修改文件
- `frontend/src/style.css`
- `frontend/src/App.vue`
- `frontend/src/views/WatermarkTab.vue`

### 修改内容
- **style.css**：全局 `button` 字号 `14px` → `13px`，`min-height` `40px` → `36px`；`.primary` / `.secondary` 的 `padding` `10px 18px` → `8px 14px`；`.segmented button` 的 `padding` `8px 16px` → `6px 12px`，字号 `14px` → `13px`，`min-height` `40px` → `36px`。
- **App.vue**：底部状态栏图标按钮 `.footer-icon-btn` 尺寸 `36px` → `32px`；`.footer-start-btn`、`.footer-reset-btn` 的 `min-width` 由 `120px`/`72px` 改为 `100px`/`64px`。
- **WatermarkTab.vue**：水印位置 `.position-btn` 的 `padding` `8px` → `6px`。

---

## 文本按钮统一且整体缩小

### 修改文件
- `frontend/src/style.css`
- `frontend/src/App.vue`
- `frontend/src/views/WatermarkTab.vue`

### 修改内容
- **style.css**：全局 `button` 字号 `13px` → `12px`，`min-height` `36px` → `32px`；`.primary` / `.secondary` 的 `padding` `8px 14px` → `6px 12px`；`.segmented button` 字号 `13px` → `12px`，`min-height` `36px` → `32px`，`padding` 保持 `6px 12px`。
- **App.vue**：`.tab-settings-wrap` 内按钮字号改为 `12px` 与全局一致；底部图标按钮 `.footer-icon-btn` 尺寸 `32px` → `28px`；`.footer-start-btn`、`.footer-reset-btn` 的 `min-width` 由 `100px`/`64px` 改为 `88px`/`56px`。
- **WatermarkTab.vue**：水印位置 `.position-btn` 的 `padding` 由 `6px` 改为 `6px 12px`，与主/次按钮、分段按钮统一；字号保持 `12px`。
- 效果：所有文本按钮统一为 12px 字号、6px 12px 内边距、32px 最小高度，整体更小且一致。

---

## 窗口默认尺寸缩小

### 修改文件
- `src-tauri/tauri.conf.json`

### 修改内容
- 主窗口默认宽度 `860` → `720`，默认高度 `560` → `520`，启动时窗口更小。

---

## 功能设置区缩小并消除横向滚动条

### 修改文件
- `frontend/src/App.vue`

### 修改内容
- **Grid**：中间列由固定 `360px` 改为 `minmax(240px, 320px)`，功能设置区在 240–320px 之间伸缩。
- **功能设置区**：`.tab-settings-wrap` 由 `flex: 0 0 360px; min-width: 280px` 改为 `flex: 1 1 320px; min-width: 240px; max-width: 320px`，区域变窄且可随窗口收缩。
- **右侧视频区**：`.pane-video-list` 的 `min-width: 260px` 改为 `min-width: 0`，允许占满剩余空间且不撑出宽度。
- **主内容区**：`.content` 增加 `overflow-x: hidden`，避免出现横向滚动条；`.main-inner` 增加 `min-width: 0`，便于 flex 子项正确收缩。
- 在 720px 窗口下总宽度不再超出，且不出现横向滚动条。

---

## 窗口控制按钮图标放大

### 修改文件
- `frontend/src/App.vue`

### 修改内容
- `.titlebar-btn`：字号 `14px` → `18px`，尺寸 `40px × 36px` → `44px × 40px`，最小化/最大化/关闭符号更大更易点。
- `.titlebar`：高度 `36px` → `40px`，与按钮高度一致。

---

## 窗口控制按钮右侧无边距

### 修改文件
- `frontend/src/App.vue`

### 修改内容
- `.titlebar` 的 `padding` 由 `0 12px 0 12px` 改为 `0 0 0 16px`，右侧无内边距，窗口控制按钮贴右边缘。

---

## 界面文本不可选中（仅输入框可选中）

### 修改文件
- `frontend/src/style.css`

### 修改内容
- `#app` 增加 `user-select: none`，应用内文本默认不可选中。
- 为 `#app` 下的 `input[type="text"]`、`input[type="number"]`、`input:not([type])`、`textarea` 设置 `user-select: text`，仅文本输入框和文本域可选中。

---

## 左侧菜单栏：文字加粗、图标与文字居中

### 修改文件
- `frontend/src/App.vue`

### 修改内容
- `.nav-item`：`font-weight` 由 `500` 改为 `600`；增加 `justify-content: center`，`text-align: center`；左右内边距改为对称 `10px 8px`。
- `.nav-label`：`flex: 1` 改为 `flex: 0 1 auto`，使图标与文字作为一组在菜单项内居中。

---

## 应用图标替换为 icon.视频批量处理.png 转 ICO

### 修改与新增
- 使用 `icon.视频批量处理.png`（已为正方形）通过 Node 脚本 `src-tauri/icons/png-to-ico.mjs` 生成 `icon.ico`，已覆盖原 `src-tauri/icons/icon.ico`。
- 项目根目录已安装依赖 `png-to-ico`（及此前为裁剪准备的 `sharp`），脚本保留于 `src-tauri/icons/png-to-ico.mjs`，后续换图可再运行：`node src-tauri/icons/png-to-ico.mjs`。
- 删除未使用的 `src-tauri/icons/png_to_ico.py`。

### 图标仍不更新时的处理（本次补充）
- **原因**：Windows 会缓存 exe 图标；且 ICO 需包含 16/24/32/48/64/256 等多层，32px 层建议为首层，否则开发/任务栏显示可能不对。
- **做法**：用 Tauri 官方命令从 PNG 生成全套图标：先将 `icon.视频批量处理.png` 复制为 `src-tauri/icons/app-icon.png`（避免中文路径），再执行 `npm run tauri icon src-tauri/icons/app-icon.png`，生成符合要求的 `icon.ico` 等。
- 已执行上述命令并清理 `src-tauri/target`。后续换图可：更新 `app-icon.png` 后执行 `npm run tauri icon src-tauri/icons/app-icon.png`，再删 `target` 后重新 `tauri dev` 或 `tauri build`。

---

## 标题栏去掉 Play 图标

### 修改文件
- `frontend/src/App.vue`

### 修改内容
- 移除标题栏左侧的 Play 图标组件及其 `lucide-vue-next` 的 `Play` 导入；删除仅用于该图标的 `.titlebar-icon` 样式。标题栏仅保留文字「视频批量处理」。

---

## 文本输入框与下拉框统一缩小

### 修改文件
- `frontend/src/style.css`
- `frontend/src/App.vue`
- `frontend/src/views/NormalizerTab.vue`
- `frontend/src/views/WatermarkTab.vue`

### 修改内容
- **style.css**：全局 `input`、`select`、`textarea` 字号 `14px` → `12px`，内边距 `10px 12px` → `6px 10px`，增加 `min-height: 30px`、`box-sizing: border-box`；滑块 `input[type="range"]` 高度 `20px` → `18px`。
- **App.vue**：`.tab-settings-wrap` 内 `input`、`select` 字号改为 `12px` 与全局一致。
- **NormalizerTab.vue**：`.input-num` 宽度 `100px` → `88px`。
- **WatermarkTab.vue**：`.opacity-num` 宽度 `60px` → `56px`，内边距 `6px 8px` → `5px 6px`。
- 效果：所有文本输入框、数字框、下拉框与滑块在视觉和尺寸上与 12px 按钮一致，更紧凑。

---

## 输出目录置顶 + 设置抽屉

### 1. 各功能输出目录放在最上面

### 修改文件
- `frontend/src/views/WatermarkTab.vue`
- `frontend/src/views/MergeTab.vue`

### 修改内容
- **WatermarkTab**：将「输出目录（输出保持原命名）」整块移到最上方，顺序为：输出目录 → 水印图片 → 水印不透明度 → 水印位置。
- **MergeTab**：将「输出目录」整块移到最上方，顺序为：输出目录 → 插入位置 → 插入视频。
- **NormalizerTab**：原本「输出设置」已在最上，未改动。

### 2. 点击设置按钮从状态栏往上拉出半屏设置抽屉

### 修改文件
- `frontend/src/App.vue`

### 修改内容
- 状态栏「设置」按钮点击后打开设置抽屉：`showSettingsDrawer = true`。
- 使用 `Teleport to="body"` 渲染遮罩与抽屉面板；遮罩半透明，点击遮罩关闭抽屉。
- 抽屉面板：自底部滑出，高度 `50vh`、最小高度 `280px`，圆角与阴影，内含标题「设置」、关闭按钮（×）、设置内容区；当前内容为「外观」一行（主题切换按钮 + 深色/浅色文案）。
- 抽屉与遮罩使用 `Transition name="drawer"`：进入时遮罩淡入、面板自下向上滑入，离开时反向。

### 3. 抽屉从状态栏上缘往上拉（非窗口底部）

### 修改文件
- `frontend/src/App.vue`
- `frontend/src/style.css`

### 修改内容
- 在 `style.css` 的 `:root` 中定义 `--footer-height: 48px`；`App.vue` 中 `.footer-bar` 使用 `height: var(--footer-height)`。
- 设置抽屉面板 `.settings-drawer-panel` 的 `bottom` 由 `0` 改为 `var(--footer-height)`，使抽屉紧贴状态栏上缘向上拉出、不覆盖状态栏；Teleport 到 body 的抽屉通过全局变量获取状态栏高度。
- 动画改为从状态栏上缘「向上展开」：面板增加 `transform-origin: bottom`，进入/离开由 `translateY(100%)` 改为 `scaleY(0)` / `scaleY(1)`，使抽屉以状态栏为锚点向上展开、收起，而非从窗口底部整体滑入滑出。
- 遮罩不覆盖状态栏：`.settings-drawer-backdrop` 的 `inset: 0` 改为 `top: 0; left: 0; right: 0; bottom: var(--footer-height)`，拉出设置页时状态栏不被黑色遮罩遮住。
- 抽屉阴影改为往上投影：`.settings-drawer-panel` 的 `box-shadow` 改为双层向上阴影（`0 -4px 12px` 近缘 + `0 -16px 48px` 扩散），浅色/深色主题分别调整透明度，使阴影明显投射到上方内容区。
- 抽屉不向状态栏投阴影、状态栏始终最顶层并向上投影：抽屉去掉 `border-bottom`；状态栏 `.footer-bar` 增加 `position: relative`、`z-index: 10000`（高于抽屉 9999），使状态栏始终位于最顶层；状态栏增加向上投影 `box-shadow: 0 -2px 8px`，浅色/深色主题分别设透明度，抽屉打开时状态栏在上、其阴影落在下方抽屉上。
